<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Extension Detection Test</title>
</head>
<body>
    <h1>Extension Detection Test</h1>
    <div id="status">Checking extension...</div>
    
    <!-- Demos Extension Detector -->
    <script src="demos-extension-detector-v2.js"></script>
    
    <script>
        // Wait for extension detection
        setTimeout(async () => {
            const providers = await window.detectDemosExtension();
            const statusDiv = document.getElementById('status');
            
            if (providers.length > 0) {
                statusDiv.innerHTML = `
                    <h2>✅ Extension Detected!</h2>
                    <p>Found ${providers.length} provider(s):</p>
                    <ul>
                        ${providers.map(p => `<li>${p.info?.name || 'Unknown'} (${p.info?.uuid || 'No UUID'})</li>`).join('')}
                    </ul>
                    <button onclick="testConnection()">Test Connection</button>
                `;
            } else {
                statusDiv.innerHTML = `
                    <h2>❌ No Extension Detected</h2>
                    <p>Please install the Demos extension and refresh the page.</p>
                    <button onclick="manualDetect()">Manual Detection</button>
                `;
            }
        }, 2000);
        
        function testConnection() {
            console.log('Testing connection...');
            window.requestDemosProviders().then(providers => {
                console.log('Providers:', providers);
                alert('Found ' + providers.length + ' providers. Check console for details.');
            });
        }
        
        function manualDetect() {
            console.log('Manual detection...');
            console.log('Available window properties:', Object.keys(window).filter(key => key.toLowerCase().includes('demos') || key.toLowerCase().includes('ethereum') || key.toLowerCase().includes('web3') || key.toLowerCase().includes('inject')));
            
            // Try multiple event names that extensions might use
            const eventNames = [
                'demosRequestProvider',
                'ethereumRequestProvider', 
                'web3RequestProvider',
                'providerRequest',
                'connectRequest',
                'accountRequest'
            ];
            
            console.log('Dispatching multiple provider request events...');
            eventNames.forEach(eventName => {
                console.log('Dispatching:', eventName);
                window.dispatchEvent(new Event(eventName));
            });
            
            setTimeout(() => {
                const providers = window.demosProviders || [];
                console.log('Providers after manual detection:', providers);
                alert('Manual detection found ' + providers.length + ' providers. Check console for details.');
            }, 2000);
        }
    </script>
</body>
</html>